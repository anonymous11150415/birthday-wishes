<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>生日快乐！</title>
    <style>
        /* 全局样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            font-family: 'Arial', sans-serif;
            color: #333;
            overflow-x: hidden;
            background: #ffecd2;
        }

        /* 入场动画界面 */
        #entrance {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #ff9a9e 0%, #fad0c4 99%, #fad0c4 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 1s ease-in-out;
        }

        #entrance.hidden {
            opacity: 0;
            pointer-events: none;
        }

        #entrance h1 {
            font-size: 3em;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            animation: bounce 2s infinite;
        }

        #entrance button {
            padding: 15px 30px;
            font-size: 1.2em;
            border: none;
            border-radius: 25px;
            background: white;
            color: #ff9a9e;
            cursor: pointer;
            transition: transform 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        #entrance button:hover {
            transform: scale(1.1);
        }

        /* 主界面 */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        .main-container.visible {
            opacity: 1;
        }

        /* 卡片区域 */
        .card-section {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 50px 0;
        }

        .birthday-card {
            position: relative;
            width: 300px;
            height: 400px;
            perspective: 1500px;
            margin: 20px;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.8s;
            cursor: pointer;
        }

        .birthday-card:hover .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .card-front {
            background: white;
        }

        .card-back {
            background: #ff9a9e;
            transform: rotateY(180deg);
            color: white;
        }

        /* 蛋糕区域 */
        .cake-section {
            position: relative;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 50px 0;
        }

        /* 照片墙区域 */
        .photo-section {
            padding: 50px 0;
        }

        .photo-wall {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .photo-item {
            position: relative;
            padding-bottom: 100%;
            overflow: hidden;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .photo-item:hover {
            transform: scale(1.05);
        }

        .photo-item img {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* 互动区域 */
        .interactive-section {
            min-height: 100vh;
            padding: 50px 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            align-items: center;
        }

        /* 游戏区域样式 */
        .games-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }

        .game-card {
            width: 300px;
            height: 200px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            transition: transform 0.3s;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .game-card:hover {
            transform: translateY(-5px);
        }

        .game-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(255,255,255,0.9);
            transition: opacity 0.3s;
        }

        /* 礼物盒样式 */
        .gift-box-container {
            width: 150px;
            height: 150px;
            position: relative;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.5s;
        }

        .gift-box-lid {
            position: absolute;
            width: 100%;
            height: 30px;
            background: #ff4081;
            top: -30px;
            transform-origin: bottom;
            transition: transform 0.5s;
        }

        .gift-box-container.open .gift-box-lid {
            transform: rotateX(-110deg);
        }

        .gift-box-body {
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #ff4081, #ff80ab);
            position: relative;
            transform-style: preserve-3d;
        }

        .gift-ribbon {
            position: absolute;
            width: 30px;
            height: 100%;
            background: #f50057;
            left: 50%;
            transform: translateX(-50%);
        }

        .gift-ribbon::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 30px;
            background: #f50057;
            top: 50%;
            left: -60px;
            transform: translateY(-50%) rotate(90deg);
        }

        /* 愿望树样式 */
        .wish-tree-container {
            width: 300px;
            height: 400px;
            position: relative;
        }

        .tree-trunk {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 100px;
            background: linear-gradient(45deg, #795548, #5d4037);
            border-radius: 5px;
        }

        .tree-crown {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 300px;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            background: linear-gradient(45deg, #4caf50, #81c784);
        }

        .wish-leaf {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .wish-leaf:hover {
            transform: scale(1.2);
        }

        .wish-form {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            display: none;
            z-index: 1000;
        }

        .wish-form input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .wish-form button {
            padding: 10px 20px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .wish-form button:hover {
            background: #45a049;
        }

        /* 音乐控制器 */
        .music-controller {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        /* 动画效果 */
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* 3D蛋糕样式 */
        .cake-container {
            position: relative;
            width: 300px;
            height: 300px;
            transform-style: preserve-3d;
            animation: rotate 20s infinite linear;
        }

        .cake-layer {
            position: absolute;
            width: 100%;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transform-style: preserve-3d;
        }

        .cake-layer-1 { 
            background: linear-gradient(45deg, #ff9a9e, #fad0c4);
            transform: translateY(120px);
            width: 200px;
            height: 80px;
        }

        .cake-layer-2 {
            background: linear-gradient(45deg, #fad0c4, #ffd1ff);
            transform: translateY(80px);
            width: 240px;
            height: 70px;
        }

        .cake-layer-3 {
            background: linear-gradient(45deg, #ffd1ff, #ff9a9e);
            transform: translateY(40px);
            width: 280px;
            height: 60px;
        }

        .candle {
            position: absolute;
            width: 10px;
            height: 30px;
            background: #fff;
            top: -30px;
            border-radius: 5px;
            transform-style: preserve-3d;
        }

        .flame {
            position: absolute;
            width: 16px;
            height: 16px;
            background: #ffd700;
            border-radius: 50%;
            top: -16px;
            left: -3px;
            filter: blur(2px);
            animation: flicker 0.3s infinite alternate;
        }

        /* 照片墙样式增强 */
        .photo-item {
            transform: perspective(800px) rotateY(0deg);
            transition: transform 0.5s;
        }

        .photo-item:hover {
            transform: perspective(800px) rotateY(15deg) scale(1.1);
            box-shadow: -10px 10px 20px rgba(0,0,0,0.2);
        }

        .photo-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            transform: translateY(100%);
            transition: transform 0.3s;
        }

        .photo-item:hover .photo-caption {
            transform: translateY(0);
        }

        /* 特效样式 */
        .sparkle {
            position: absolute;
            pointer-events: none;
            animation: sparkle 1s forwards;
        }

        .heart {
            position: fixed;
            font-size: 20px;
            color: #ff4081;
            pointer-events: none;
            animation: float-up 3s forwards;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            pointer-events: none;
        }

        /* 动画关键帧 */
        @keyframes rotate {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }

        @keyframes flicker {
            0% { transform: scale(0.9); opacity: 0.8; }
            100% { transform: scale(1.1); opacity: 1; }
        }

        @keyframes sparkle {
            0% { transform: scale(0) rotate(0deg); opacity: 1; }
            100% { transform: scale(1) rotate(180deg); opacity: 0; }
        }

        @keyframes float-up {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }

        @keyframes confetti-fall {
            0% { transform: translateY(-10px) rotate(0deg); }
            100% { transform: translateY(100vh) rotate(360deg); }
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .main-container {
                padding: 10px;
            }

            .birthday-card {
                width: 280px;
                height: 380px;
            }

            .photo-wall {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }

        /* 倒计时样式 */
        .countdown-container {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 100;
            text-align: center;
        }

        .countdown-title {
            font-size: 16px;
            color: #ff4081;
            margin-bottom: 10px;
        }

        .countdown-time {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .countdown-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .countdown-number {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .countdown-label {
            font-size: 12px;
            color: #666;
        }

        /* 音乐播放列表样式 */
        .music-playlist {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 100;
            max-width: 300px;
            display: none;
        }

        .playlist-title {
            font-size: 16px;
            color: #ff4081;
            margin-bottom: 10px;
            text-align: center;
        }

        .playlist-item {
            display: flex;
            align-items: center;
            padding: 8px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .playlist-item:hover {
            background-color: rgba(255, 64, 129, 0.1);
        }

        .playlist-item.active {
            background-color: rgba(255, 64, 129, 0.2);
        }

        .playlist-item-title {
            flex-grow: 1;
            margin-left: 10px;
            font-size: 14px;
            color: #333;
        }

        .show-playlist {
            position: fixed;
            bottom: 20px;
            right: 80px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #ff4081;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }
    </style>
</head>
<body>
    <!-- 入场动画界面 -->
    <div id="entrance">
        <h1>🎉 生日快乐！ 🎂</h1>
        <button onclick="enterMain()">点击进入</button>
    </div>

    <!-- 主界面 -->
    <div class="main-container">
        <!-- 卡片区域 -->
        <section class="card-section">
            <div class="birthday-card">
                <div class="card-inner">
                    <div class="card-front">
                        <h2>祝你生日快乐！</h2>
                        <p>点击卡片查看祝福</p>
                    </div>
                    <div class="card-back">
                        <h3>亲爱的朋友</h3>
                        <p>愿你的生日充满欢乐和惊喜<br>
                           愿你所有的梦想都能实现<br>
                           愿你的未来光明而美好</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 蛋糕区域 -->
        <section class="cake-section">
            <div class="cake-container">
                <div class="cake-layer cake-layer-1"></div>
                <div class="cake-layer cake-layer-2"></div>
                <div class="cake-layer cake-layer-3">
                    <div class="candle">
                        <div class="flame" id="flame"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 照片墙区域 -->
        <section class="photo-section">
            <div class="photo-wall" id="photoWall">
                <!-- 照片将通过JavaScript动态添加 -->
            </div>
        </section>

        <!-- 互动区域 -->
        <section class="interactive-section">
            <!-- 游戏区域 -->
            <div class="games-container">
                <div class="game-card" onclick="playBalloonGame()">
                    <div class="game-content">
                        <h3>戳气球游戏</h3>
                        <p>点击开始玩</p>
                    </div>
                </div>
                <div class="game-card" onclick="playMemoryGame()">
                    <div class="game-content">
                        <h3>记忆配对</h3>
                        <p>点击开始玩</p>
                    </div>
                </div>
                <div class="game-card" onclick="playPuzzleGame()">
                    <div class="game-content">
                        <h3>生日拼图</h3>
                        <p>点击开始玩</p>
                    </div>
                </div>
            </div>

            <!-- 礼物盒 -->
            <div class="gift-box-container" onclick="toggleGift()">
                <div class="gift-box-lid"></div>
                <div class="gift-box-body">
                    <div class="gift-ribbon"></div>
                </div>
            </div>

            <!-- 愿望树 -->
            <div class="wish-tree-container">
                <div class="tree-trunk"></div>
                <div class="tree-crown"></div>
            </div>

            <!-- 愿望表单 -->
            <div class="wish-form" id="wishForm">
                <h3>写下你的愿望</h3>
                <input type="text" id="wishInput" placeholder="输入你的愿望...">
                <button onclick="addWish()">挂上愿望</button>
                <button onclick="closeWishForm()">关闭</button>
            </div>
        </section>
    </div>

    <!-- 音乐控制器 -->
    <div class="music-controller" onclick="toggleMusic()">
        🎵
    </div>

    <!-- 音频元素 -->
    <audio id="bgMusic" loop>
        <source src="music/江存潇_-_记忆博物馆_(纯音乐版)_.mp3" type="audio/mpeg">
    </audio>

    <!-- 倒计时容器 -->
    <div class="countdown-container">
        <div class="countdown-title">距离生日还有</div>
        <div class="countdown-time">
            <div class="countdown-item">
                <span class="countdown-number" id="countdown-days">00</span>
                <span class="countdown-label">天</span>
            </div>
            <div class="countdown-item">
                <span class="countdown-number" id="countdown-hours">00</span>
                <span class="countdown-label">时</span>
            </div>
            <div class="countdown-item">
                <span class="countdown-number" id="countdown-minutes">00</span>
                <span class="countdown-label">分</span>
            </div>
            <div class="countdown-item">
                <span class="countdown-number" id="countdown-seconds">00</span>
                <span class="countdown-label">秒</span>
            </div>
        </div>
    </div>

    <!-- 音乐播放列表 -->
    <button class="show-playlist" onclick="togglePlaylist()">🎵</button>
    <div class="music-playlist" id="musicPlaylist">
        <div class="playlist-title">生日歌单</div>
        <div class="playlist-item active" onclick="changeSong(0)">
            <span class="playlist-item-title">生日快乐歌</span>
        </div>
        <div class="playlist-item" onclick="changeSong(1)">
            <span class="playlist-item-title">祝你生日快乐</span>
        </div>
        <div class="playlist-item" onclick="changeSong(2)">
            <span class="playlist-item-title">Happy Birthday To You</span>
        </div>
        <div class="playlist-item" onclick="changeSong(3)">
            <span class="playlist-item-title">生日祝福歌</span>
        </div>
    </div>

    <script>
        // 入场动画控制
        function enterMain() {
            document.getElementById('entrance').classList.add('hidden');
            document.querySelector('.main-container').classList.add('visible');
            // 自动播放背景音乐
            document.getElementById('bgMusic').play().catch(() => {
                console.log('自动播放被阻止，需要用户交互');
            });
        }

        // 音乐控制
        function toggleMusic() {
            const audio = document.getElementById('bgMusic');
            if (audio.paused) {
                audio.play();
            } else {
                audio.pause();
            }
        }

        // 照片墙初始化
        const photos = [
            { url: 'images/35c2f6c8a7b4a5dee6eb5acc168bb1f.png', caption: '美好的回忆' },
            // 可以添加更多照片
        ];

        function initPhotoWall() {
            const photoWall = document.getElementById('photoWall');
            photos.forEach(photo => {
                const photoItem = document.createElement('div');
                photoItem.className = 'photo-item';
                
                const img = document.createElement('img');
                img.src = photo.url;
                img.alt = photo.caption;
                
                const caption = document.createElement('div');
                caption.className = 'photo-caption';
                caption.textContent = photo.caption;
                
                photoItem.appendChild(img);
                photoItem.appendChild(caption);
                photoWall.appendChild(photoItem);
            });
        }

        // 特效函数
        function createSparkle(x, y) {
            const sparkle = document.createElement('div');
            sparkle.className = 'sparkle';
            sparkle.style.left = x + 'px';
            sparkle.style.top = y + 'px';
            sparkle.style.backgroundColor = `hsl(${Math.random() * 360}, 70%, 50%)`;
            document.body.appendChild(sparkle);
            
            setTimeout(() => sparkle.remove(), 1000);
        }

        function createHeart(x, y) {
            const heart = document.createElement('div');
            heart.className = 'heart';
            heart.textContent = '❤';
            heart.style.left = x + 'px';
            heart.style.top = y + 'px';
            document.body.appendChild(heart);
            
            setTimeout(() => heart.remove(), 3000);
        }

        function createConfetti() {
            const colors = ['#ff4081', '#00bcd4', '#ffd700', '#64ffda', '#ff6e40'];
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * window.innerWidth + 'px';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animation = `confetti-fall ${2 + Math.random() * 3}s linear forwards`;
                document.body.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 5000);
            }
        }

        // 蛋糕交互
        function handleCakeClick() {
            const flame = document.getElementById('flame');
            if (flame.style.display !== 'none') {
                flame.style.display = 'none';
                createConfetti();
                for (let i = 0; i < 10; i++) {
                    setTimeout(() => {
                        createHeart(
                            Math.random() * window.innerWidth,
                            window.innerHeight
                        );
                    }, i * 300);
                }
            }
        }

        // 鼠标移动特效
        document.addEventListener('mousemove', (e) => {
            if (Math.random() < 0.1) {
                createSparkle(e.clientX, e.clientY);
            }
        });

        // 游戏相关函数
        function playBalloonGame() {
            let score = 0;
            const gameArea = document.createElement('div');
            gameArea.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 1000;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            `;

            const scoreDisplay = document.createElement('div');
            scoreDisplay.style.position = 'fixed';
            scoreDisplay.style.top = '20px';
            scoreDisplay.style.left = '20px';
            scoreDisplay.style.color = 'white';
            scoreDisplay.style.fontSize = '24px';
            scoreDisplay.textContent = `得分: ${score}`;
            gameArea.appendChild(scoreDisplay);

            function createBalloon() {
                const balloon = document.createElement('div');
                balloon.style.position = 'absolute';
                balloon.style.left = Math.random() * (window.innerWidth - 50) + 'px';
                balloon.style.top = window.innerHeight + 'px';
                balloon.style.width = '50px';
                balloon.style.height = '60px';
                balloon.style.background = `hsl(${Math.random() * 360}, 70%, 50%)`;
                balloon.style.borderRadius = '50%';
                balloon.style.cursor = 'pointer';
                balloon.style.transition = 'top 3s linear';

                balloon.onclick = () => {
                    score += 1;
                    scoreDisplay.textContent = `得分: ${score}`;
                    balloon.remove();
                    createConfetti();
                };

                gameArea.appendChild(balloon);
                setTimeout(() => {
                    balloon.style.top = '-60px';
                }, 100);

                setTimeout(() => balloon.remove(), 3000);
            }

            document.body.appendChild(gameArea);
            const gameInterval = setInterval(createBalloon, 1000);

            setTimeout(() => {
                clearInterval(gameInterval);
                gameArea.innerHTML = `
                    <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                         color: white; font-size: 24px; text-align: center;">
                        游戏结束！<br>
                        最终得分: ${score}<br>
                        <button onclick="this.parentElement.parentElement.remove()" 
                                style="padding: 10px 20px; margin-top: 20px; cursor: pointer;">
                            关闭
                        </button>
                    </div>
                `;
            }, 30000);
        }

        // 记忆配对游戏
        function playMemoryGame() {
            const emojis = ['🎂', '🎈', '🎁', '🎉', '🎊', '🎵', '🎸', '🎺'];
            const cards = [...emojis, ...emojis];
            let flippedCards = [];
            let matchedPairs = 0;
            let canFlip = true;

            // 创建游戏区域
            const gameArea = document.createElement('div');
            gameArea.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 1000;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            `;

            // 创建游戏容器
            const gameContainer = document.createElement('div');
            gameContainer.style.cssText = `
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 10px;
                padding: 20px;
                background: white;
                border-radius: 10px;
                max-width: 500px;
            `;

            // 洗牌算法
            function shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // 创建卡片
            shuffle(cards).forEach((emoji, index) => {
                const card = document.createElement('div');
                card.style.cssText = `
                    width: 100px;
                    height: 100px;
                    background: #ff4081;
                    border-radius: 10px;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    font-size: 40px;
                    cursor: pointer;
                    transition: transform 0.3s;
                    transform-style: preserve-3d;
                `;
                card.innerHTML = '<span style="display: none;">' + emoji + '</span>';
                
                card.onclick = () => {
                    if (!canFlip || card.classList.contains('flipped')) return;
                    
                    card.classList.add('flipped');
                    card.querySelector('span').style.display = 'block';
                    card.style.background = 'white';
                    flippedCards.push(card);

                    if (flippedCards.length === 2) {
                        canFlip = false;
                        const [card1, card2] = flippedCards;
                        
                        if (card1.textContent === card2.textContent) {
                            matchedPairs++;
                            flippedCards = [];
                            canFlip = true;
                            createConfetti();
                            
                            if (matchedPairs === emojis.length) {
                                setTimeout(() => {
                                    alert('恭喜你完成了记忆配对游戏！');
                                    gameArea.remove();
                                }, 500);
                            }
                        } else {
                            setTimeout(() => {
                                card1.classList.remove('flipped');
                                card2.classList.remove('flipped');
                                card1.querySelector('span').style.display = 'none';
                                card2.querySelector('span').style.display = 'none';
                                card1.style.background = '#ff4081';
                                card2.style.background = '#ff4081';
                                flippedCards = [];
                                canFlip = true;
                            }, 1000);
                        }
                    }
                };
                
                gameContainer.appendChild(card);
            });

            // 添加关闭按钮
            const closeButton = document.createElement('button');
            closeButton.textContent = '关闭游戏';
            closeButton.style.cssText = `
                margin-top: 20px;
                padding: 10px 20px;
                background: #ff4081;
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
            `;
            closeButton.onclick = () => gameArea.remove();

            gameArea.appendChild(gameContainer);
            gameArea.appendChild(closeButton);
            document.body.appendChild(gameArea);
        }

        // 拼图游戏
        function playPuzzleGame() {
            const gameArea = document.createElement('div');
            gameArea.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 1000;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            `;

            const puzzleContainer = document.createElement('div');
            puzzleContainer.style.cssText = `
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 2px;
                padding: 10px;
                background: white;
                border-radius: 10px;
                position: relative;
            `;

            const pieces = [];
            const size = 3;
            let emptyIndex = size * size - 1;

            // 创建拼图图案
            function createPuzzlePattern(element, index) {
                const colors = ['#ff4081', '#3f51b5', '#4caf50', '#ffc107', '#9c27b0', '#00bcd4', '#ff5722', '#795548'];
                element.style.background = colors[index % colors.length];
                element.style.display = 'flex';
                element.style.justifyContent = 'center';
                element.style.alignItems = 'center';
                element.style.fontSize = '24px';
                element.style.color = 'white';
                element.textContent = index + 1;
            }

            // 检查是否可以移动
            function canMove(index) {
                const row = Math.floor(index / size);
                const col = index % size;
                const emptyRow = Math.floor(emptyIndex / size);
                const emptyCol = emptyIndex % size;
                
                return (
                    (Math.abs(row - emptyRow) === 1 && col === emptyCol) ||
                    (Math.abs(col - emptyCol) === 1 && row === emptyRow)
                );
            }

            // 检查是否完成
            function checkWin() {
                return pieces.every((piece, index) => {
                    return index === size * size - 1 || 
                           parseInt(piece.textContent) === index + 1;
                });
            }

            // 创建拼图块
            for (let i = 0; i < size * size; i++) {
                const piece = document.createElement('div');
                piece.style.cssText = `
                    width: 100px;
                    height: 100px;
                    border-radius: 5px;
                    cursor: pointer;
                    transition: transform 0.2s;
                `;

                if (i !== size * size - 1) {
                    createPuzzlePattern(piece, i);
                }

                piece.onclick = () => {
                    const index = pieces.indexOf(piece);
                    if (canMove(index)) {
                        // 交换位置
                        [pieces[index], pieces[emptyIndex]] = [pieces[emptyIndex], pieces[index]];
                        puzzleContainer.innerHTML = '';
                        pieces.forEach(p => puzzleContainer.appendChild(p));
                        emptyIndex = index;

                        if (checkWin()) {
                            createConfetti();
                            setTimeout(() => {
                                alert('恭喜你完成了拼图游戏！');
                                gameArea.remove();
                            }, 500);
                        }
                    }
                };

                pieces.push(piece);
            }

            // 打乱拼图
            function shufflePuzzle() {
                for (let i = 0; i < 100; i++) {
                    const movablePieces = pieces.reduce((acc, piece, index) => {
                        if (canMove(index)) acc.push(index);
                        return acc;
                    }, []);

                    const randomIndex = movablePieces[Math.floor(Math.random() * movablePieces.length)];
                    [pieces[randomIndex], pieces[emptyIndex]] = [pieces[emptyIndex], pieces[randomIndex]];
                    emptyIndex = randomIndex;
                }
            }

            shufflePuzzle();
            pieces.forEach(piece => puzzleContainer.appendChild(piece));

            // 添加关闭按钮
            const closeButton = document.createElement('button');
            closeButton.textContent = '关闭游戏';
            closeButton.style.cssText = `
                margin-top: 20px;
                padding: 10px 20px;
                background: #ff4081;
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
            `;
            closeButton.onclick = () => gameArea.remove();

            gameArea.appendChild(puzzleContainer);
            gameArea.appendChild(closeButton);
            document.body.appendChild(gameArea);
        }

        // 礼物盒功能
        function toggleGift() {
            const giftBox = document.querySelector('.gift-box-container');
            if (!giftBox.classList.contains('open')) {
                giftBox.classList.add('open');
                createConfetti();
                const surprises = [
                    '🎁 收到一个神秘礼物！',
                    '🎈 获得一个生日气球！',
                    '🎂 获得一块虚拟蛋糕！',
                    '💝 收到一份特别的祝福！',
                    '🎉 获得一个惊喜包！'
                ];
                const surprise = surprises[Math.floor(Math.random() * surprises.length)];
                setTimeout(() => {
                    alert(surprise);
                    giftBox.classList.remove('open');
                }, 1000);
            }
        }

        // 愿望树功能
        let wishes = [];

        function addWish() {
            const wishText = document.getElementById('wishInput').value.trim();
            if (wishText) {
                wishes.push(wishText);
                createWishLeaf(wishText);
                closeWishForm();
                document.getElementById('wishInput').value = '';
            }
        }

        function createWishLeaf(text) {
            const leaf = document.createElement('div');
            leaf.className = 'wish-leaf';
            leaf.style.backgroundColor = `hsl(${Math.random() * 360}, 70%, 50%)`;
            leaf.title = text;
            
            // 随机位置，但确保在树冠范围内
            const treeCrown = document.querySelector('.tree-crown');
            const rect = treeCrown.getBoundingClientRect();
            const x = Math.random() * (rect.width - 30);
            const y = Math.random() * (rect.height - 30);
            
            leaf.style.left = x + 'px';
            leaf.style.top = y + 'px';
            
            treeCrown.appendChild(leaf);
        }

        function showWishForm() {
            document.getElementById('wishForm').style.display = 'block';
        }

        function closeWishForm() {
            document.getElementById('wishForm').style.display = 'none';
        }

        // 初始化一些愿望
        const initialWishes = [
            '生日快乐！',
            '心想事成！',
            '永远开心！',
            '梦想成真！'
        ];

        document.addEventListener('DOMContentLoaded', () => {
            // 初始化愿望树
            initialWishes.forEach(wish => {
                wishes.push(wish);
                createWishLeaf(wish);
            });

            // 添加愿望树点击事件
            document.querySelector('.wish-tree-container').addEventListener('click', (e) => {
                if (e.target.classList.contains('wish-leaf')) {
                    alert('愿望：' + e.target.title);
                } else {
                    showWishForm();
                }
            });

            initPhotoWall();
            
            // 添加蛋糕点击事件
            const cake = document.querySelector('.cake-container');
            cake.addEventListener('click', handleCakeClick);
            
            // 创建一些初始的特效
            setInterval(() => {
                if (Math.random() < 0.3) {
                    createHeart(
                        Math.random() * window.innerWidth,
                        window.innerHeight
                    );
                }
            }, 2000);
        });

        // 倒计时功能
        function updateCountdown() {
            const birthday = new Date('2024-12-25T00:00:00'); // 设置目标生日日期
            const now = new Date();
            const diff = birthday - now;

            if (diff > 0) {
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                document.getElementById('countdown-days').textContent = String(days).padStart(2, '0');
                document.getElementById('countdown-hours').textContent = String(hours).padStart(2, '0');
                document.getElementById('countdown-minutes').textContent = String(minutes).padStart(2, '0');
                document.getElementById('countdown-seconds').textContent = String(seconds).padStart(2, '0');
            } else {
                document.querySelector('.countdown-container').innerHTML = `
                    <div class="countdown-title">🎉 生日快乐！ 🎉</div>
                `;
            }
        }

        setInterval(updateCountdown, 1000);
        updateCountdown();

        // 音乐播放列表功能
        const playlist = [
            'birthday.mp3',
            'happy_birthday_chinese.mp3',
            'happy_birthday_english.mp3',
            'birthday_wish.mp3'
        ];

        let currentSong = 0;

        function togglePlaylist() {
            const playlist = document.getElementById('musicPlaylist');
            playlist.style.display = playlist.style.display === 'none' ? 'block' : 'none';
        }

        function changeSong(index) {
            if (index === currentSong) return;

            currentSong = index;
            const audio = document.getElementById('bgMusic');
            audio.src = playlist[index];
            audio.play();

            // 更新活动项
            document.querySelectorAll('.playlist-item').forEach((item, i) => {
                item.classList.toggle('active', i === index);
            });
        }

        // 音乐自动播放下一首
        document.getElementById('bgMusic').addEventListener('ended', () => {
            currentSong = (currentSong + 1) % playlist.length;
            changeSong(currentSong);
        });
    </script>
</body>
</html>
